import{E as ot,G as O,H as nt,J as v,M as rt,N as W,S as x,V as C,_ as B,aa as it,ca as j}from"./chunk-3D6TIEIV.js";import{U as z,V as N}from"./chunk-G3SJLT24.js";import{fb as b,ic as P}from"./chunk-FDJQKATD.js";import{Bc as I,Ec as at,L as Q,O as K,P as s,T as Z,W as X,bc as et,ec as D,lb as c,zc as T}from"./chunk-MP5PPKB7.js";import{W as $,X as tt}from"./chunk-LT72WXA6.js";import{Q as w,c as M}from"./chunk-NRW4C74H.js";import{f as U,h as n,n as r}from"./chunk-YJSZZTEX.js";n();r();var R=U(M());n();r();var st={location:0,distance:50,threshold:.2,shouldSort:!0,keys:[{name:"info.name",weight:.5},{name:"info.keybaseUsername",weight:.3},{name:"info.website",weight:.1},{name:"voteAccountPubkey",weight:.1},{name:"identityPubkey",weight:.1}]},ct={identityPublicKey:"7GkMBmtrTZz8QbjSe1sXvAUtz7Pp42SQxfT5ymmJD4We",voteAccountPublicKey:"J2nUHEAgZFRyuJbFjdqPrAa9gyWDuc7hErtDQHPhsYRp"};n();r();var ut=e=>(o,i)=>{let t=e.indexOf(o.voteAccountPubkey),d=e.indexOf(i.voteAccountPubkey);return(t>-1?t:1/0)-(d>-1?d:1/0)};n();r();n();r();var mt=new Error("Failed to fetch recommended staking validators.");async function dt(){try{let e=await Z.api().get("/staking/v1/recommended");if(!X(e))throw mt;let o=e.data;return ot.parse(o).validators}catch{throw mt}}var lt=()=>{let e=nt.recommendedValidators();return at({enabled:!0,queryKey:e,gcTime:rt.Long,staleTime:1/0,async queryFn(){return dt()}})};function kt(){let{connection:e}=z(),o=W(e),{results:i=[]}=o,t=lt(),{data:d=null,isFetched:E}=B(),F=et.isFeatureEnabled("kill-phantom-validator"),[a,u]=(0,R.useState)(""),y=$(a),k=(0,R.useMemo)(()=>{let A=i.map(V=>({...V,totalApy:d?O(d,V?.commission):null})),S=t.data??[];if(S.length===0)return A;let L=A.sort(ut(S));return F?L.filter(V=>V.identityPubkey!==ct.identityPublicKey):L},[i,t.data,d,F]),g=tt(k,y||"",st),m=(0,R.useCallback)(()=>{o.isError&&!o.isFetching&&o.refetch(),t.isError&&!t.isFetching&&t.refetch()},[t,o]),l=!o.isFetched||!E||!t.isFetched,f=o.isError||t.isError,h=o.isSuccess;return{isLoading:l,isSuccess:h,hasError:f,searchResults:g,showApy:d!==null,onRefetch:m,searchTerm:a,setSearchTerm:u}}n();r();function ft({stakePubkey:e,stakeAuthorityPubkey:o,authorizedPubkey:i,transaction:t=new K.Transaction}){return o.equals(i)||t.add(s.StakeProgram.authorize({authorizedPubkey:i,newAuthorizedPubkey:i,stakeAuthorizationType:s.StakeAuthorizationLayout.Staker,stakePubkey:e})),t.add(s.StakeProgram.deactivate({stakePubkey:e,authorizedPubkey:i})),t}var At=e=>{let{t:o}=w(),i=T(),t=v(),{mutateAsync:d}=N(e);return I({mutationFn:async({accountIdentifier:a,senderAddress:u,stakePubkey:y,stakeAuthorityPubkey:k,authorizedPubkey:g})=>{if(!u)throw C;let{networkID:m,address:l}=u,f=ft({stakePubkey:y,stakeAuthorityPubkey:k,authorizedPubkey:g}),h=await b(f,{connection:e}),A={ownerAddress:l??"",networkID:m,data:{signature:""},type:"deactivateState",display:{summary:{topLeft:{text:o("transactionsPendingDeactivatingStake")}}}};t.approved({chainType:"solana",chainName:"solana",networkId:c.getSolanaNetworkIDValue(m),type:"undelegate"});let S=await d({accountIdentifier:a,feePayer:new s.PublicKey(l),transaction:h,pendingTransactionInput:A});return t.submittedTransaction(S,{chainType:"solana",chainName:"solana",networkId:c.getSolanaNetworkIDValue(m),method:"signAndSendTransaction"}),t.deactivateStake(),{networkID:m,id:S??""}},onSuccess:a=>{P({connection:e,signature:a.id}).then(()=>{t.transactionStatus(a.id,{chainType:"solana",chainName:"solana",networkId:c.getSolanaNetworkIDValue(a.networkID),status:{type:"confirmed"}})}).catch(u=>{t.transactionStatus(a.id,{chainType:"solana",chainName:"solana",networkId:c.getSolanaNetworkIDValue(a.networkID),status:{type:"error"}}),D.captureError(u,"staking")}),x(e,a.id,i)}})};n();r();function J({stakePubkey:e,authorizedPubkey:o,votePubkey:i}){return s.StakeProgram.delegate({stakePubkey:e,authorizedPubkey:o,votePubkey:i})}var gt=e=>{let{t:o}=w(),i=T(),t=v(),{mutateAsync:d}=N(e);return I({mutationFn:async({accountIdentifier:a,senderAddress:u,stakePubkey:y,authorizedPubkey:k,votePubkey:g})=>{if(!u)throw C;let{networkID:m,address:l}=u,f=J({stakePubkey:y,authorizedPubkey:k,votePubkey:g}),h=await b(f,{connection:e}),A={ownerAddress:l??"",networkID:m,data:{signature:""},type:"delegateStake",display:{summary:{topLeft:{text:o("transactionsPendingDelegatingStake")}}}};t.approved({chainType:"solana",chainName:"solana",networkId:c.getSolanaNetworkIDValue(m),type:"delegate"});let S=await d({accountIdentifier:a,feePayer:new s.PublicKey(l),transaction:h,pendingTransactionInput:A});return t.submittedTransaction(S,{chainType:"solana",chainName:"solana",networkId:c.getSolanaNetworkIDValue(m),method:"signAndSendTransaction"}),{networkID:m,id:S??""}},onSuccess:a=>{P({connection:e,signature:a.id}).then(()=>{t.transactionStatus(a.id,{chainType:"solana",chainName:"solana",networkId:c.getSolanaNetworkIDValue(a.networkID),status:{type:"confirmed"}})}).catch(u=>{t.transactionStatus(a.id,{chainType:"solana",chainName:"solana",networkId:c.getSolanaNetworkIDValue(a.networkID),status:{type:"error"}}),D.captureError(u,"staking")}),x(e,a.id,i)}})};n();r();function ht({stakePubkey:e,authorizedPubkey:o,amount:i,transaction:t=new K.Transaction}){return t.add(s.StakeProgram.withdraw({stakePubkey:e,authorizedPubkey:o,toPubkey:o,lamports:i})),t}var wt=e=>{let{t:o}=w(),i=T(),t=v(),{mutateAsync:d}=N(e);return I({mutationFn:async({accountIdentifier:a,senderAddress:u,stakePubkey:y,authorizedPubkey:k,amount:g})=>{if(!u)throw C;let{networkID:m,address:l}=u,f=ht({stakePubkey:y,authorizedPubkey:k,amount:g}),h=await b(f,{connection:e}),A={ownerAddress:l??"",networkID:m,data:{signature:""},type:"withdrawStake",display:{summary:{topLeft:{text:o("transactionsPendingWithdrawingStake")}}}};t.approved({chainType:"solana",chainName:"solana",networkId:c.getSolanaNetworkIDValue(m),type:"withdraw"});let S=await d({accountIdentifier:a,feePayer:new s.PublicKey(l),transaction:h,pendingTransactionInput:A});return t.submittedTransaction(S,{chainType:"solana",chainName:"solana",networkId:c.getSolanaNetworkIDValue(m),method:"signAndSendTransaction"}),{networkID:m,id:S??""}},onSuccess:a=>{P({connection:e,signature:a.id}).then(()=>{t.transactionStatus(a.id,{chainType:"solana",chainName:"solana",networkId:c.getSolanaNetworkIDValue(a.networkID),status:{type:"confirmed"}})}).catch(u=>{t.transactionStatus(a.id,{chainType:"solana",chainName:"solana",networkId:c.getSolanaNetworkIDValue(a.networkID),status:{type:"error"}}),D.captureError(u,"staking")}),x(e,a.id,i)}})};n();r();function Dt({ownerPublicKey:e,lamports:o,transaction:i=new K.Transaction}){let t=s.Keypair.generate();return i.add(s.StakeProgram.createAccount({fromPubkey:e,stakePubkey:t.publicKey,authorized:new s.Authorized(e,e),lamports:o})),[i,t]}function Tt({lamports:e,votePubkey:o,authorizedPubkey:i}){let[t,d]=Dt({ownerPublicKey:i,lamports:e});return t.add(J({stakePubkey:d.publicKey,authorizedPubkey:i,votePubkey:o})),[t,d]}var It=e=>{let{t:o}=w(),i=T(),t=v(),{mutateAsync:d}=N(e);return I({mutationFn:async({accountIdentifier:a,senderAddress:u,lamports:y,votePubkey:k,authorizedPubkey:g,usdPerSol:m})=>{if(!u)throw C;let{networkID:l,address:f}=u,[h,A]=Tt({accountIdentifier:a,senderAddress:u,lamports:y,votePubkey:k,authorizedPubkey:g}),S=await b(h,{connection:e}),L={ownerAddress:f??"",networkID:l,data:{signature:""},type:"createAccountAndDelegateStake",display:{summary:{topLeft:{text:o("transactionsPendingCreatingAndDelegatingStake")}}}};t.approved({chainType:"solana",chainName:"solana",networkId:c.getSolanaNetworkIDValue(l),type:"delegate"});let V=await d({accountIdentifier:a,feePayer:new s.PublicKey(f),transaction:S,pendingTransactionInput:L,opts:{additionalSignerAccounts:[A]}});t.submittedTransaction(V,{chainType:"solana",chainName:"solana",networkId:c.getSolanaNetworkIDValue(l),method:"signAndSendTransaction"});let Y=Q(y),yt=m?Y.times(m):void 0;return t.createStakeAccountAndDelegateStake({sol:Y.toNumber(),usd:yt?.toNumber(),voteAccountPubkey:k}),{networkID:l,id:V??""}},onSuccess:a=>{P({connection:e,signature:a.id}).then(()=>{t.transactionStatus(a.id,{chainType:"solana",chainName:"solana",networkId:c.getSolanaNetworkIDValue(a.networkID),status:{type:"confirmed"}})}).catch(u=>{t.transactionStatus(a.id,{chainType:"solana",chainName:"solana",networkId:c.getSolanaNetworkIDValue(a.networkID),status:{type:"error"}}),D.captureError(u,"staking")}),x(e,a.id,i)}})};n();r();n();r();var pt=U(M());n();r();var Nt=U(M());n();r();function St(){let{isSupported:e,defaultProvider:o}=j(c.solana.mainnetID),{hasConvertibleStakeAccounts:i}=it(o);return{shouldShowLiquidStakingCTA:e&&i}}n();r();var bt=U(M());n();r();var Pt=U(M());n();r();export{kt as a,St as b,At as c,gt as d,wt as e,It as f};
//# sourceMappingURL=chunk-Y5DSDVWB.js.map
